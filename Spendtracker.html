<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Modern Spending Tracker</title>
    <!-- Tailwind CSS CDN -->
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- Inter Font -->
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
    <!-- Font Awesome for Icons (e.g., for categories, delete button) -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css">
    <style>
        body {
            font-family: 'Inter', sans-serif;
            /* Using a subtle background gradient for a modern feel */
            @apply bg-gradient-to-br from-blue-50 to-indigo-100 min-h-screen flex flex-col items-center justify-start py-8 px-4 sm:px-6 lg:px-8;
            overflow-y: auto; /* Ensure scrolling is enabled for the entire page */
        }
        .card {
            /* Enhanced card styling with rounded corners, shadows, and padding */
            @apply bg-white p-8 rounded-2xl shadow-xl w-full max-w-md mx-auto mb-6 border border-gray-100;
        }
        .input-field {
            /* Consistent styling for input fields with focus effects */
            @apply w-full p-3 rounded-xl border border-gray-300 focus:ring-4 focus:ring-blue-200 focus:border-blue-400 transition-all duration-300 outline-none;
        }
        .btn {
            /* Base button styling for consistent look and feel */
            @apply w-full py-3 px-4 rounded-xl font-semibold transition-all duration-300 transform hover:-translate-y-0.5 hover:shadow-lg focus:outline-none focus:ring-4 focus:ring-opacity-75;
        }
        .btn-primary {
            /* Primary button with gradient background */
            @apply bg-gradient-to-r from-blue-500 to-indigo-600 text-white hover:from-blue-600 hover:to-indigo-700 focus:ring-blue-300;
        }
        .btn-secondary {
            /* Secondary button for logout/minor actions */
            @apply bg-gray-200 text-gray-800 hover:bg-gray-300 focus:ring-gray-300;
        }
        .message-box {
            /* Styling for success and error messages */
            @apply mt-4 p-3 rounded-lg font-medium text-sm;
            box-shadow: 0 2px 5px rgba(0,0,0,0.05);
        }
        .message-box.success {
            @apply bg-green-100 text-green-700 border border-green-200;
        }
        .message-box.error {
            @apply bg-red-100 text-red-700 border border-red-200;
        }
        .tab-button {
            /* Styling for tab navigation buttons */
            @apply flex-1 py-3 px-4 rounded-xl text-center font-medium transition-all duration-300;
        }
        .tab-button.active {
            /* Active tab button styling with gradient */
            @apply bg-gradient-to-r from-blue-500 to-indigo-600 text-white shadow-lg;
        }
        .tab-button.inactive {
            /* Inactive tab button styling */
            @apply bg-gray-100 text-gray-700 hover:bg-gray-200;
        }
        .expense-item-card {
            /* Styling for individual expense list items */
            @apply bg-white p-4 rounded-xl shadow-sm flex flex-col sm:flex-row justify-between items-start sm:items-center border border-gray-200 transition-all duration-200 hover:shadow-md;
        }
        .expense-details {
            /* Flex-grow to allow details to take available space */
            @apply flex-grow mb-2 sm:mb-0;
        }
        .delete-btn {
            /* Styling for delete button with icon and hover effects */
            @apply mt-2 sm:mt-0 ml-0 sm:ml-4 flex-shrink-0 bg-red-500 text-white p-2 rounded-full hover:bg-red-600 transition-colors duration-200 text-sm;
            box-shadow: 0 2px 5px rgba(239, 68, 68, 0.2);
        }
        /* Custom scrollbar for better aesthetics */
        ::-webkit-scrollbar {
            width: 8px;
        }
        ::-webkit-scrollbar-track {
            background: #f1f1f1;
            border-radius: 10px;
        }
        ::-webkit-scrollbar-thumb {
            background: #cbd5e1; /* gray-300 */
            border-radius: 10px;
        }
        ::-webkit-scrollbar-thumb:hover {
            background: #a0aec0; /* gray-400 */
        }
    </style>
</head>
<body class="min-h-screen flex flex-col items-center justify-start py-8 px-4 sm:px-6 lg:px-8 overflow-y-auto">

    <!-- Authentication Section -->
    <div id="auth-section" class="card mt-8 sm:mt-16 max-w-lg mx-auto">
        <h2 class="text-3xl font-bold text-center text-gray-800 mb-8">Unlock Your Spending Tracker</h2>
        
        <div class="flex bg-gray-100 rounded-xl p-1 mb-8 shadow-inner">
            <button id="register-tab" class="tab-button active">Register</button>
            <button id="login-tab" class="tab-button inactive">Login</button>
        </div>

        <form id="register-form" class="space-y-6">
            <div>
                <label for="register-email" class="block text-gray-700 text-sm font-medium mb-1">Email Address</label>
                <input type="email" id="register-email" placeholder="e.g., yourname@example.com" required class="input-field">
            </div>
            <div>
                <label for="register-password" class="block text-gray-700 text-sm font-medium mb-1">Password</label>
                <input type="password" id="register-password" placeholder="Choose a Password (min 6 characters)" required class="input-field">
            </div>
            <button type="submit" class="btn btn-primary">Register Account</button>
        </form>

        <form id="login-form" class="space-y-6 hidden">
            <div>
                <label for="login-email" class="block text-gray-700 text-sm font-medium mb-1">Email Address</label>
                <input type="email" id="login-email" placeholder="e.g., yourname@example.com" required class="input-field">
            </div>
            <div>
                <label for="login-password" class="block text-gray-700 text-sm font-medium mb-1">Password</label>
                <input type="password" id="login-password" placeholder="Your Password" required class="input-field">
            </div>
            <button type="submit" class="btn btn-primary">Log In</button>
        </form>

        <div id="auth-message-box" class="message-box hidden" role="alert"></div>
    </div>

    <!-- Main Application Section -->
    <div id="app-section" class="w-full max-w-5xl mx-auto hidden flex flex-col h-full space-y-6">
        <header class="flex flex-col sm:flex-row justify-between items-center py-5 px-6 bg-white shadow-lg rounded-2xl mb-4 text-center sm:text-left border border-gray-100">
            <h1 class="text-2xl sm:text-3xl font-bold text-gray-800 mb-3 sm:mb-0">ðŸ’° Modern Spending Tracker</h1>
            <div class="flex flex-col sm:flex-row items-center space-y-3 sm:space-y-0 sm:space-x-4">
                <span id="user-display" class="text-gray-600 font-medium text-sm sm:text-base px-3 py-1 bg-gray-50 rounded-lg"></span>
                <button id="logout-button" class="btn btn-secondary py-2 px-5 text-sm w-full sm:w-auto">Logout</button>
            </div>
        </header>

        <main class="grid grid-cols-1 lg:grid-cols-3 gap-6 flex-grow">
            <!-- Add New Expense Form -->
            <section class="lg:col-span-1 card">
                <h2 class="text-2xl font-semibold text-gray-800 mb-6">Add New Expense</h2>
                <form id="expense-form" class="space-y-6">
                    <div>
                        <label for="expense-date" class="block text-gray-700 text-sm font-medium mb-1">Date</label>
                        <input type="date" id="expense-date" required class="input-field">
                    </div>
                    <div>
                        <label for="expense-category" class="block text-gray-700 text-sm font-medium mb-1">Category</label>
                        <input type="text" id="expense-category" placeholder="e.g., Food, Transport" required class="input-field">
                    </div>
                    <div>
                        <label for="expense-amount" class="block text-gray-700 text-sm font-medium mb-1">Amount</label>
                        <input type="number" id="expense-amount" placeholder="e.g., 25.50" step="0.01" required class="input-field">
                    </div>
                    <div>
                        <label for="expense-description" class="block text-gray-700 text-sm font-medium mb-1">Description (Optional)</label>
                        <input type="text" id="expense-description" placeholder="Optional notes" class="input-field">
                    </div>
                    <div>
                        <label for="expense-payment-method" class="block text-gray-700 text-sm font-medium mb-1">Payment Method</label>
                        <select id="expense-payment-method" required class="input-field">
                            <option value="">Select Method</option>
                            <option value="Cash">Cash</option>
                            <option value="Credit Card">Credit Card</option>
                            <option value="Debit Card">Debit Card</option>
                            <option value="Bank Transfer">Bank Transfer</option>
                            <option value="Mobile Payment">Mobile Payment</option>
                        </select>
                    </div>
                    <button type="submit" class="btn btn-primary">Add Expense</button>
                </form>
                <div id="expense-message-box" class="message-box hidden" role="alert"></div>
            </section>

            <!-- Expense List & Other Features Section -->
            <section class="lg:col-span-2 flex flex-col space-y-6">
                <!-- Your Expenses List -->
                <div class="card flex-grow flex flex-col">
                    <h2 class="text-2xl font-semibold text-gray-800 mb-6">Your Expenses</h2>
                    <div id="expense-list" class="space-y-4 overflow-y-auto flex-grow pr-1">
                        <p class="text-gray-500 text-center py-4">No expenses yet. Add some above!</p>
                    </div>
                </div>

                <!-- Placeholder for Charts -->
                <div class="card">
                    <h2 class="text-2xl font-semibold text-gray-800 mb-6">Spending Overview (Charts)</h2>
                    <div id="charts-section" class="text-gray-500 text-center py-8">
                        Charts will appear here to visualize your spending trends.
                        <!-- Chart canvas or container will be dynamically added here -->
                    </div>
                </div>

                <!-- Placeholder for Import/Export -->
                <div class="card">
                    <h2 class="text-2xl font-semibold text-gray-800 mb-6">Data Management</h2>
                    <div id="data-management-section" class="text-gray-500 text-center py-8 space-y-4">
                        <p>Import and export your spending data.</p>
                        <div class="flex flex-col sm:flex-row gap-4 justify-center">
                            <button id="export-json-btn" class="btn btn-secondary text-sm sm:w-1/2">Export as JSON</button>
                            <label for="import-json-file" class="btn btn-secondary text-sm sm:w-1/2 cursor-pointer flex items-center justify-center">
                                Import from JSON
                                <input type="file" id="import-json-file" accept=".json" class="hidden">
                            </label>
                        </div>
                    </div>
                </div>
            </section>
        </main>
    </div>

    <script type="module">
        // Add this line right after the opening <script type="module"> tag
        console.log("Spendtracker app script loaded successfully!");

        // Firebase SDK Imports
        import { initializeApp } from "https://www.gstatic.com/firebasejs/10.9.0/firebase-app.js";
        import { 
            getAuth, 
            createUserWithEmailAndPassword, 
            signInWithEmailAndPassword, 
            signOut, 
            onAuthStateChanged 
        } from "https://www.gstatic.com/firebasejs/10.9.0/firebase-auth.js";
        import { 
            getFirestore, 
            collection, 
            addDoc, 
            query, 
            where, 
            onSnapshot, 
            deleteDoc, 
            doc 
        } from "https://www.gstatic.com/firebasejs/10.9.0/firebase-firestore.js";

        // Your web app's Firebase configuration
        // REPLACE THIS ENTIRE BLOCK WITH YOUR firebaseConfig OBJECT from your NEW Firebase Project (SpendtrackerNew or my-spendingtracker)
        // Go to Firebase Console -> Project settings -> General -> "Your apps" section -> select your web app -> "Config"
        const firebaseConfig = {
            // Placeholder values - REPLACE THESE WITH YOUR ACTUAL CONFIG FROM FIREBASE CONSOLE
            apiKey: "YOUR_API_KEY",
            authDomain: "your-project-id.firebaseapp.com",
            projectId: "your-project-id",
            storageBucket: "your-project-id.appspot.com",
            messagingSenderId: "YOUR_MESSAGING_SENDER_ID",
            appId: "YOUR_APP_ID"
        };
        

        // Initialize Firebase
        const app = initializeApp(firebaseConfig);
        const auth = getAuth(app);
        const db = getFirestore(app);

        // UI Elements - ALL ELEMENTS MUST BE DECLARED HERE FOR GLOBAL SCRIPT ACCESS
        const authSection = document.getElementById('auth-section');
        const appSection = document.getElementById('app-section');
        const authMessageBox = document.getElementById('auth-message-box');
        const expenseMessageBox = document.getElementById('expense-message-box');

        const registerTab = document.getElementById('register-tab');
        const loginTab = document.getElementById('login-tab');
        const registerForm = document.getElementById('register-form');
        const loginForm = document.getElementById('login-form');

        const registerEmailInput = document.getElementById('register-email');
        const registerPasswordInput = document.getElementById('register-password');
        const loginEmailInput = document.getElementById('login-email');
        const loginPasswordInput = document.getElementById('login-password');

        const logoutButton = document.getElementById('logout-button');
        const userDisplay = document.getElementById('user-display');
        const expenseForm = document.getElementById('expense-form');
        const expenseDate = document.getElementById('expense-date');
        const expenseCategory = document.getElementById('expense-category');
        const expenseAmount = document.getElementById('expense-amount');
        const expenseDescription = document.getElementById('expense-description');
        const expensePaymentMethod = document.getElementById('expense-payment-method');
        const expenseList = document.getElementById('expense-list');

        // New UI Elements for Charts/Data Management
        const chartsSection = document.getElementById('charts-section');
        const exportJsonBtn = document.getElementById('export-json-btn');
        const importJsonFile = document.getElementById('import-json-file');


        let currentUserId = null; // To store the current authenticated user's ID

        // Helper function to show messages
        function showMessage(message, type, element) {
            element.textContent = message;
            element.className = `message-box ${type}`; // Reset classes and apply new ones
            element.classList.remove('hidden');
            setTimeout(() => {
                element.classList.add('hidden');
            }, 5000); // Hide after 5 seconds
        }

        // Tab switching logic
        registerTab.addEventListener('click', () => {
            registerTab.classList.add('active');
            registerTab.classList.remove('inactive');
            loginTab.classList.add('inactive');
            loginTab.classList.remove('active');
            registerForm.classList.remove('hidden');
            loginForm.classList.add('hidden');
            authMessageBox.classList.add('hidden'); // Clear previous messages
        });

        loginTab.addEventListener('click', () => {
            loginTab.classList.add('active');
            loginTab.classList.remove('inactive');
            registerTab.classList.add('inactive');
            registerTab.classList.remove('active');
            loginForm.classList.remove('hidden');
            registerForm.classList.add('hidden');
            authMessageBox.classList.add('hidden'); // Clear previous messages
        });

        // Handle Registration
        registerForm.addEventListener('submit', async (event) => {
            event.preventDefault();
            const email = registerEmailInput.value;
            const password = registerPasswordInput.value;

            try {
                await createUserWithEmailAndPassword(auth, email, password);
                showMessage("Registration successful! You are now logged in.", "success", authMessageBox);
                // onAuthStateChanged will handle UI update
            } catch (error) {
                console.error("Registration error:", error.code, error.message);
                let errorMessage = `Registration failed. Please try again. (${error.code || 'unknown'}: ${error.message || 'No specific message'})`;
                if (error.code === 'auth/email-already-in-use') {
                    errorMessage = "This email is already in use. Please log in or use a different email.";
                } else if (error.code === 'auth/invalid-email') {
                    errorMessage = "Invalid email address.";
                } else if (error.code === 'auth/weak-password') {
                    errorMessage = "Password should be at least 6 characters.";
                } else if (error.code === 'auth/network-request-failed') {
                    errorMessage = "Network error. Please check your internet connection.";
                }
                showMessage(errorMessage, "error", authMessageBox);
            }
        });

        // Handle Login
        loginForm.addEventListener('submit', async (event) => {
            event.preventDefault();
            const email = loginEmailInput.value;
            const password = loginPasswordInput.value;

            try {
                await signInWithEmailAndPassword(auth, email, password);
                showMessage("Login successful! Welcome back.", "success", authMessageBox);
                // onAuthStateChanged will handle UI update
            } catch (error) {
                console.error("Login error:", error.code, error.message);
                let errorMessage = `Login failed. Please check your email and password. (${error.code || 'unknown'}: ${error.message || 'No specific message'})`;
                if (error.code === 'auth/invalid-email') {
                    errorMessage = "Invalid email address.";
                } else if (error.code === 'auth/user-not-found' || error.code === 'auth/wrong-password') {
                    errorMessage = "Invalid email or password.";
                } else if (error.code === 'auth/network-request-failed') {
                    errorMessage = "Network error. Please check your internet connection.";
                }
                showMessage(errorMessage, "error", authMessageBox);
            }
        });

        // Handle Logout
        logoutButton.addEventListener('click', async () => {
            try {
                await signOut(auth);
                showMessage("Logged out successfully.", "success", authMessageBox);
                // onAuthStateChanged will handle UI update
            } catch (error) {
                console.error("Logout error:", error);
                showMessage("Logout failed. Please try again.", "error", authMessageBox);
            }
        });

        // Auth state observer
        onAuthStateChanged(auth, (user) => {
            if (user) {
                // User is signed in
                currentUserId = user.uid;
                console.log("Logged in user ID:", currentUserId); // For debugging sync
                userDisplay.textContent = `Welcome, ${user.email}`;
                authSection.classList.add('hidden');
                appSection.classList.remove('hidden');
                loadExpenses(currentUserId); // Load expenses for the logged-in user
                expenseMessageBox.classList.add('hidden'); // Hide any previous expense messages
            } else {
                // User is signed out
                currentUserId = null;
                console.log("User logged out. currentUserId is:", currentUserId); // For debugging sync
                userDisplay.textContent = ''; // Clear user display
                authSection.classList.remove('hidden');
                appSection.classList.add('hidden');
                expenseList.innerHTML = '<p class="text-gray-500 text-center py-4">No expenses yet. Add some above!</p>'; // Clear expenses
                // Ensure correct form is shown when logged out
                registerTab.click(); // Default to register form
            }
        });

        // Handle adding expenses
        expenseForm.addEventListener('submit', async (event) => {
            event.preventDefault();
            if (!currentUserId) {
                showMessage("Please log in to add expenses.", "error", expenseMessageBox);
                return;
            }
            console.log("Attempting to save expense for user ID:", currentUserId); // For debugging sync

            const date = expenseDate.value;
            const category = expenseCategory.value;
            const amount = parseFloat(expenseAmount.value);
            const description = expenseDescription.value;
            const paymentMethod = expensePaymentMethod.value;

            if (!date || !category || isNaN(amount) || amount <= 0 || !paymentMethod) {
                showMessage("Please fill in all required expense fields correctly.", "error", expenseMessageBox);
                return;
            }

            try {
                await addDoc(collection(db, `users/${currentUserId}/expenses`), {
                    date: date,
                    category: category,
                    amount: amount,
                    description: description,
                    paymentMethod: paymentMethod,
                    timestamp: new Date() // Add a timestamp for ordering
                });
                showMessage("Expense added successfully!", "success", expenseMessageBox);
                expenseForm.reset(); // Clear the form
            } catch (error) {
                console.error("Error adding document: ", error);
                showMessage("Failed to add expense. Permission denied for Firestore. Please check your Firebase security rules.", "error", expenseMessageBox);
            }
        });

        // Load expenses for the current user
        function loadExpenses(userId) {
            const expensesCollectionRef = collection(db, `users/${userId}/expenses`);
            // Use onSnapshot for real-time updates
            onSnapshot(expensesCollectionRef, (snapshot) => {
                const expenses = [];
                snapshot.forEach((doc) => {
                    expenses.push({ id: doc.id, ...doc.data() });
                });

                // Sort expenses by date and then by timestamp if dates are the same
                expenses.sort((a, b) => {
                    const dateA = new Date(a.date);
                    const dateB = new Date(b.date);
                    if (dateA.getTime() === dateB.getTime()) {
                        // If dates are the same, sort by timestamp
                        return b.timestamp.toDate() - a.timestamp.toDate();
                    }
                    return dateB - dateA; // Sort by date descending
                });

                displayExpenses(expenses);
            }, (error) => {
                console.error("Error fetching expenses: ", error);
                showMessage("Failed to load expenses. Please check your permissions.", "error", expenseMessageBox);
            });
        }

        // Display expenses in the UI
        function displayExpenses(expenses) {
            expenseList.innerHTML = ''; // Clear current list
            if (expenses.length === 0) {
                expenseList.innerHTML = '<p class="text-gray-500 text-center py-4">No expenses yet. Add some above!</p>';
                return;
            }

            expenses.forEach(expense => {
                const expenseItem = document.createElement('div');
                expenseItem.className = 'expense-item-card'; /* Using custom class for consistent styling */
                expenseItem.innerHTML = `
                    <div class="expense-details">
                        <p class="font-semibold text-gray-800">${expense.category}: $${expense.amount.toFixed(2)}</p>
                        <p class="text-sm text-gray-600">${expense.date} - ${expense.paymentMethod}</p>
                        ${expense.description ? `<p class="text-xs text-gray-500">${expense.description}</p>` : ''}
                    </div>
                    <button class="delete-btn bg-red-500 text-white p-2 rounded-full hover:bg-red-600 transition-colors duration-200 text-sm" data-id="${expense.id}"><i class="fas fa-trash-alt"></i></button>
                `;
                expenseList.appendChild(expenseItem);
            });

            // Add event listeners for delete buttons
            document.querySelectorAll('.delete-btn').forEach(button => {
                button.addEventListener('click', (e) => {
                    const expenseId = e.target.dataset.id; // Correctly get data-id from the button
                    // Handle cases where icon might be clicked instead of button directly
                    if (!expenseId) {
                        const parentButton = e.target.closest('button.delete-btn');
                        if (parentButton) {
                            deleteExpense(parentButton.dataset.id);
                        }
                    } else {
                        deleteExpense(expenseId);
                    }
                });
            });
        }

        // Handle deleting expenses
        async function deleteExpense(expenseId) {
            if (!currentUserId) {
                showMessage("Please log in to delete expenses.", "error", expenseMessageBox);
                return;
            }
            try {
                await deleteDoc(doc(db, `users/${currentUserId}/expenses`, expenseId));
                showMessage("Expense deleted successfully!", "success", expenseMessageBox);
            } catch (error) {
                console.error("Error removing document: ", error);
                showMessage("Failed to delete expense. Please check your permissions.", "error", expenseMessageBox);
            }
        });

        // --- Data Import/Export Functions (Placeholders for now) ---

        // Export data as JSON
        exportJsonBtn.addEventListener('click', async () => {
            if (!currentUserId) {
                showMessage("Please log in to export data.", "error", expenseMessageBox);
                return;
            }
            try {
                const expensesSnapshot = await getDocs(collection(db, `users/${currentUserId}/expenses`));
                const expensesData = [];
                expensesSnapshot.forEach(doc => {
                    expensesData.push(doc.data());
                });

                const jsonString = JSON.stringify(expensesData, null, 2); // Pretty print JSON

                const blob = new Blob([jsonString], { type: 'application/json' });
                const url = URL.createObjectURL(blob);
                const a = document.createElement('a');
                a.href = url;
                a.download = `spendtracker_expenses_${currentUserId}.json`;
                document.body.appendChild(a);
                a.click();
                document.body.removeChild(a);
                URL.revokeObjectURL(url);
                showMessage("Expenses exported successfully!", "success", expenseMessageBox);
            } catch (error) {
                console.error("Error exporting data:", error);
                showMessage("Failed to export expenses. Please try again.", "error", expenseMessageBox);
            }
        });

        // Import data from JSON
        importJsonFile.addEventListener('change', (event) => {
            if (!currentUserId) {
                showMessage("Please log in to import data.", "error", expenseMessageBox);
                return;
            }
            const file = event.target.files[0];
            if (!file) return;

            const reader = new FileReader();
            reader.onload = async (e) => {
                try {
                    const importedData = JSON.parse(e.target.result);
                    if (!Array.isArray(importedData)) {
                        showMessage("Invalid JSON format. Expected an array of expenses.", "error", expenseMessageBox);
                        return;
                    }

                    // For simplicity, we'll add new expenses. More advanced logic might handle duplicates.
                    for (const expense of importedData) {
                        // Basic validation for imported data structure
                        if (expense.date && expense.category && typeof expense.amount === 'number' && expense.amount > 0 && expense.paymentMethod) {
                            await addDoc(collection(db, `users/${currentUserId}/expenses`), {
                                date: expense.date,
                                category: expense.category,
                                amount: expense.amount,
                                description: expense.description || '', // Default to empty string if missing
                                paymentMethod: expense.paymentMethod,
                                timestamp: new Date() // Set new timestamp for ordering
                            });
                        } else {
                            console.warn("Skipping invalid imported expense:", expense);
                        }
                    }
                    showMessage("Expenses imported successfully!", "success", expenseMessageBox);
                } catch (error) {
                    console.error("Error importing data:", error);
                    showMessage("Failed to import expenses. Ensure the file is a valid JSON array of expenses.", "error", expenseMessageBox);
                }
            };
            reader.readAsText(file);
        });

        // Set today's date as default for the date input
        const today = new Date();
        const yyyy = today.getFullYear();
        const mm = String(today.getMonth() + 1).padStart(2, '0'); // Months are 0-indexed
        const dd = String(today.getDate()).padStart(2, '0');
        expenseDate.value = `${yyyy}-${mm}-${dd}`;
    </script>
</body>
</html>
